<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>百家乐网页版</title>
    <style>
        /* 基础重置 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        /* 通用样式 */
        .container {
            width: 100%;
            max-width: 480px;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            position: relative;
            overflow-y: auto; /* 允许垂直滚动 */
            -webkit-overflow-scrolling: touch; /* 平滑滚动 */
        }

        .center-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        button {
            border: none;
            outline: none;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s ease;
            user-select: none;
        }

        /* Header 样式 */
        .app-header {
            width: 100%;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            margin-bottom: 10px;
            background-color: transparent;
            position: relative; /* 确保层级 */
            z-index: 10;
        }

        .header-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0;
            /* visibility: hidden; 删除这行，让标题显示 */
            flex: 1; /* 占据中间空间 */
            text-align: center; /* 居中 */
        }

        /* 创建一个空的占位元素来平衡右边的按钮，使标题绝对居中 */
        .header-placeholder {
            width: 40px; 
            height: 40px;
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 8px;
            cursor: pointer;
            color: #333; /* 加深颜色 */
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
            width: 40px;
            height: 40px;
        }

        .icon-btn:active {
            background-color: #f0f0f0;
        }

        /* 模态遮罩层 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none; /* 默认隐藏 */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.2s ease-out;
        }

        /* 模态内容框 */
        .modal-content {
            width: 85%;
            max-width: 320px;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            animation: slideUp 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            padding: 0 5px;
            line-height: 1;
        }

        /* 限红列表 */
        .limit-list {
            padding: 10px 0;
        }

        .limit-option {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .limit-option:active {
            background-color: #f9f9f9;
        }

        .limit-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .limit-text {
            flex: 1;
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }

        .check-icon {
            color: #0066cc;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .limit-option input[type="radio"]:checked ~ .limit-text {
            color: #0066cc;
        }

        .limit-option input[type="radio"]:checked ~ .check-icon {
            opacity: 1;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* 开局设置页 */
        #settings-page {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .page-title {
            display: none;
        }

        .input-row {
            width: 80%;
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group-half {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-group-half label {
            font-size: 16px; /* 稍微缩小字体以适应并排 */
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group-half input {
            width: 100%;
            padding: 12px 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 8px;
            outline: none;
            background-color: #fff;
        }

        .input-group {
            width: 80%;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 18px;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 10px;
            font-size: 18px;
            border: 1px solid #ccc;
            border-radius: 8px;
            outline: none;
            background-color: #fff;
        }

        .input-group input:focus {
            border-color: #0066cc;
            box-shadow: 0 0 0 2px rgba(0, 102, 204, 0.2);
        }

        .btn-primary {
            width: 180px;
            height: 60px;
            background-color: #0066cc;
            color: white;
            font-size: 20px;
            font-weight: bold;
            border-radius: 30px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 102, 204, 0.3);
        }

        .btn-primary:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 102, 204, 0.3);
        }

        .btn-primary:disabled {
            background-color: #ccc;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* 游戏主页面 */
        #game-page {
            width: 100%;
            height: 100%;
            display: none; /* 初始隐藏 */
            flex-direction: column;
        }

        .game-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .balance-display {
            flex: 1; /* 占据剩余空间 */
            font-size: 20px; /* 放大字体 */
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 0; /* 移除底部间距 */
            display: flex;
            align-items: center;
            justify-content: center;
            height: 90px; /* 增加高度 */
        }

        .stats-display {
            flex: 1.5; /* 统计栏稍宽 */
            display: flex;
            flex-wrap: wrap; /* 允许换行 */
            justify-content: space-between;
            align-content: center;
            background: white;
            padding: 10px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 16px; /* 放大字体 */
            margin-bottom: 0; /* 移除底部间距 */
            height: 90px; /* 增加高度 */
        }
        
        .stats-item {
            width: 48%; /* 每行显示两个 */
            font-weight: bold;
            margin: 2px 0;
            line-height: 1.4;
        }

        /* 结果显示区 */
        .result-display {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            flex-shrink: 0;
        }

        .probability-display {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 14px;
            color: #666;
        }

        .probability-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .probability-value {
            font-weight: bold;
            font-size: 16px;
            margin-top: 4px;
        }

        .result-row {
            margin-bottom: 12px;
            font-size: 18px;
        }

        .current-result {
            font-size: 28px;
            font-weight: bold;
            margin: 15px 0;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-legend {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        /* 颜色类 */
        .color-P { color: #0066cc; }
        .color-B { color: #cc0000; }
        .color-T { color: #009933; }
        .bg-P { background-color: #0066cc; color: white; }
        .bg-B { background-color: #cc0000; color: white; }
        .bg-T { background-color: #009933; color: white; }

        /* 历史记录 */
        .history-container {
            width: 100%;
            height: 80px;
            background: #e8e8e8;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            white-space: nowrap;
            padding: 15px;
            display: flex;
            align-items: center;
            /* 隐藏滚动条但保留功能 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }
        .history-container::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .history-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 12px;
            font-size: 20px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* 筹码选择 */
        .section-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 10px;
            padding-left: 5px;
        }

        .chip-selection {
            display: flex;
            justify-content: center; /* 居中对齐 */
            gap: 15px; /* 增加间距 */
            margin-bottom: 20px;
        }

        .chip {
            width: 15%; /* 缩小宽度 */
            padding: 8px 0;
            border-radius: 50%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px; /* 缩小字体 */
            background: white;
            border: 2px solid #ddd;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chip.selected {
            border: 3px solid #000;
            background-color: #ffd700;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .chip:disabled {
            background-color: #eee;
            color: #aaa;
            border-color: #eee;
            box-shadow: none;
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* 投注选择 */
        .bet-selection {
            display: flex;
            justify-content: space-between;
            margin-bottom: auto; /* 推到底部按钮上方 */
        }

        .bet-option {
            width: 31%;
            height: 100px; /* 固定高度 */
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            background: white;
            border: 2px solid transparent;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            position: relative;
        }
        
        .bet-amount {
            font-size: 14px;
            margin-top: 5px;
            color: #333;
            background: rgba(255,255,255,0.8);
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 40px;
            text-align: center;
            display: none;
        }

        .bet-odds {
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }

        .bet-option[data-bet="P"] { color: #0066cc; border-color: #e6f0ff; }
        .bet-option[data-bet="B"] { color: #cc0000; border-color: #ffe6e6; }
        .bet-option[data-bet="T"] { color: #009933; border-color: #e6ffe6; }

        .bet-option:active {
            transform: scale(0.98);
        }

        .bet-option.selected[data-bet="P"] {
            background-color: #0066cc;
            color: white;
            border-color: #004c99;
            box-shadow: 0 4px 10px rgba(0, 102, 204, 0.4);
        }

        .bet-option.selected[data-bet="B"] {
            background-color: #cc0000;
            color: white;
            border-color: #990000;
            box-shadow: 0 4px 10px rgba(204, 0, 0, 0.4);
        }

        .bet-option.selected[data-bet="T"] {
            background-color: #009933;
            color: white;
            border-color: #006622;
            box-shadow: 0 4px 10px rgba(0, 153, 51, 0.4);
        }

        .controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            padding-bottom: 20px;
            gap: 15px; /* 按钮间距 */
        }

        .btn-secondary {
            width: 120px;
            height: 60px;
            background-color: #f0f0f0;
            color: #666;
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }

        .btn-secondary:active {
            transform: scale(0.98);
            background-color: #e0e0e0;
        }

        .btn-success {
            width: 120px;
            height: 60px;
            background-color: #e6ffe6; /* 浅绿色背景 */
            color: #009933; /* 深绿色文字 */
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            border: 1px solid #00cc44;
            margin-top: 20px;
        }

        .btn-success:active {
            transform: scale(0.98);
            background-color: #ccffcc;
        }

        .btn-success:disabled {
            background-color: #f0f0f0;
            color: #aaa;
            border-color: #ddd;
            cursor: not-allowed;
            transform: none;
        }
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            font-size: 16px;
            z-index: 1000;
            display: none;
            text-align: center;
            max-width: 80%;
            pointer-events: none; /* 防止遮挡点击 */
        }

        /* 动画 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* 响应式调整：自动识别屏幕高度并调整大小 */
        @media (max-height: 800px) {
            .container { padding: 15px; }
            .app-header { height: 44px; margin-bottom: 5px; }
            .header-title { font-size: 16px; }
            .game-header-row { margin-bottom: 15px; gap: 10px; }
            .balance-display, .stats-display { height: 80px; padding: 10px; }
            .balance-display span:first-child { font-size: 14px !important; }
            .balance-display span:last-child { font-size: 20px !important; }
            .stats-display { font-size: 14px; }
            .result-display { padding: 15px; margin-bottom: 15px; }
            .current-result { font-size: 24px; margin: 10px 0; min-height: 36px; }
            .history-container { height: 60px; margin-bottom: 15px; padding: 10px; }
            .history-item { width: 40px; height: 40px; min-width: 40px; font-size: 16px; }
            .chip-selection { margin-bottom: 15px; gap: 10px; }
            .chip { padding: 5px 0; font-size: 12px; }
            .bet-option { height: 85px; font-size: 16px; }
            .bet-amount { font-size: 20px !important; }
            .controls { margin-top: 15px; gap: 10px; }
            .btn-primary, .btn-secondary, .btn-success { height: 50px; font-size: 16px; margin-top: 10px; }
        }

        @media (max-height: 650px) {
            .container { padding: 10px; }
            .game-header-row { margin-bottom: 10px; }
            .balance-display, .stats-display { height: 70px; }
            .result-display { padding: 10px; margin-bottom: 10px; }
            .current-result { margin: 5px 0; }
            .probability-display { margin-top: 10px; padding-top: 10px; }
            .history-container { height: 50px; margin-bottom: 10px; }
            .history-item { width: 34px; height: 34px; min-width: 34px; font-size: 14px; margin-right: 8px; }
            .chip-selection { margin-bottom: 10px; }
            .bet-option { height: 70px; font-size: 14px; }
            .controls { margin-top: 10px; }
            .btn-primary, .btn-secondary, .btn-success { height: 44px; font-size: 14px; }
        }
    </style>
</head>
<body>

    <!-- 开局设置页 -->
    <div id="settings-page" class="container">
        <header class="app-header">
            <div class="header-placeholder"></div>
            <h1 class="header-title">百家乐开局设置</h1>
            <button id="settings-btn" class="icon-btn" aria-label="设置">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </header>
        
        <div class="input-group">
            <label for="principal">本金金额</label>
            <input type="number" id="principal" min="100" value="1000" placeholder="请输入本金">
        </div>
        
        <div class="input-row">
            <div class="input-group-half">
                <label for="min-bet">最小投注</label>
                <input type="number" id="min-bet" min="1" value="25" placeholder="请输入最小投注" readonly style="background-color: #f5f5f5; color: #666;">
            </div>
            
            <div class="input-group-half">
                <label for="max-bet">最大投注</label>
                <input type="number" id="max-bet" min="1" value="1000000" placeholder="请输入最大投注" readonly style="background-color: #f5f5f5; color: #666;">
            </div>
        </div>
        
        <button id="start-game-btn" class="btn-primary">开始游戏</button>
    </div>

    <!-- 游戏主页面 -->
    <div id="game-page" class="container">
        <header class="app-header">
            <div class="header-placeholder"></div>
            <h1 class="header-title">百家乐</h1>
            <button id="info-btn" class="icon-btn" aria-label="说明">
                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            </button>
        </header>

        <div class="game-header-row">
            <div class="balance-display">
                <div style="display:flex; flex-direction:column;">
                    <span style="font-size:16px; color:#666; margin-bottom:5px;">当前本金</span>
                    <span id="current-balance" style="font-size: 24px;">1000</span>
                </div>
            </div>

            <div class="stats-display">
                <div class="stats-item color-B">庄：<span id="count-B">0</span></div>
                <div class="stats-item color-P">闲：<span id="count-P">0</span></div>
                <div class="stats-item color-T">和：<span id="count-T">0</span></div>
                <div class="stats-item">总：<span id="count-total">0</span></div>
            </div>
        </div>

        <div class="result-display">
            <div class="current-result" id="current-result">未开奖</div>
            
            <div class="probability-display">
                <div class="probability-item">
                    <span>庄赢率</span>
                    <span class="probability-value color-B">45.86%</span>
                </div>
                <div class="probability-item">
                    <span>闲赢率</span>
                    <span class="probability-value color-P">44.62%</span>
                </div>
                <div class="probability-item">
                    <span>和局率</span>
                    <span class="probability-value color-T">9.52%</span>
                </div>
            </div>
        </div>

        <div class="section-title">历史记录</div>
        <div class="history-container" id="history-container">
            <!-- 历史记录项将动态插入 -->
        </div>

        <div class="section-title">选择筹码</div>
        <div class="chip-selection" id="chip-container">
            <button class="chip" data-value="25">25</button>
            <button class="chip" data-value="100">100</button>
            <button class="chip" data-value="500">500</button>
            <button class="chip" data-value="1000">1000</button>
        </div>

        <div class="section-title">选择投注</div>
        <div class="bet-selection" id="bet-container">
            <button class="bet-option" data-bet="P">
                <span>闲</span>
                <span class="bet-odds">1:1</span>
                <div class="bet-amount">0</div>
            </button>
            <button class="bet-option" data-bet="T">
                <span>和</span>
                <span class="bet-odds">1:8</span>
                <div class="bet-amount">0</div>
            </button>
            <button class="bet-option" data-bet="B">
                <span>庄</span>
                <span class="bet-odds">1:0.95</span>
                <div class="bet-amount">0</div>
            </button>
        </div>

        <div class="controls">
            <button id="cancel-bet-btn" class="btn-secondary" style="display: none;">取消下注</button>
            <button id="next-round-btn" class="btn-primary">请下注</button>
            <button id="skip-round-btn" class="btn-success">飞牌</button>
        </div>
    </div>

    <!-- 提示框 -->
    <div id="toast" class="toast"></div>

    <!-- 限红设置弹窗 -->
    <div id="limit-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择限红</h3>
                <button class="close-btn" onclick="toggleModal(false)">×</button>
            </div>
            <div class="limit-list">
                <label class="limit-option">
                    <input type="radio" name="table-limit" value="25-1000000">
                    <span class="limit-text">25 - 1,000,000</span>
                    <span class="check-icon">✓</span>
                </label>
                <label class="limit-option">
                    <input type="radio" name="table-limit" value="50-1000000">
                    <span class="limit-text">50 - 1,000,000</span>
                    <span class="check-icon">✓</span>
                </label>
                <label class="limit-option">
                    <input type="radio" name="table-limit" value="100-1000000">
                    <span class="limit-text">100 - 1,000,000</span>
                    <span class="check-icon">✓</span>
                </label>
                <label class="limit-option">
                    <input type="radio" name="table-limit" value="200-1000000">
                    <span class="limit-text">200 - 1,000,000</span>
                    <span class="check-icon">✓</span>
                </label>
            </div>
        </div>
    </div>

    <!-- 说明弹窗 -->
    <div id="info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>游戏说明</h3>
                <button class="close-btn" onclick="toggleInfoModal(false)">×</button>
            </div>
            <div class="limit-list" style="padding: 20px;">
                <p style="margin-bottom: 10px;"><strong>当前限红：</strong></p>
                <p id="info-limit" style="margin-bottom: 20px; font-size: 18px; color: #0066cc;">25 - 1,000,000</p>
                
                <p style="margin-bottom: 10px;"><strong>按钮说明：</strong></p>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li><strong>飞牌：</strong>跳过下注，直接开牌。</li>
                    <li><strong>取消下注：</strong>清除所有已下注筹码。</li>
                    <li><strong>确定下注：</strong>确认并开始开奖。</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 游戏状态
        const gameState = {
            principal: 1000,
            minBet: 25,
            maxBet: 1000000,
            currentChip: null,
            bets: { P: 0, B: 0, T: 0 },
            history: [],
            counts: { P: 0, B: 0, T: 0, Total: 0 },
            isGameActive: false,
            maxRounds: 0 // 本靴最大局数
        };

        // 概率配置
        const PROBABILITIES = {
            BANKER: 45.86,
            PLAYER: 44.62,
            TIE: 9.52
        };

        // 赔率配置
        const PAYOUTS = {
            P: 1,      // 1:1
            B: 0.95,   // 1:0.95
            T: 8       // 1:8
        };

        // 颜色映射
        const COLORS = {
            P: '#0066cc',
            B: '#cc0000',
            T: '#009933'
        };

        const TEXT_MAP = {
            P: '闲赢',
            B: '庄赢',
            T: '和局'
        };

        // DOM 元素
        const settingsPage = document.getElementById('settings-page');
        const gamePage = document.getElementById('game-page');
        const startGameBtn = document.getElementById('start-game-btn');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const cancelBetBtn = document.getElementById('cancel-bet-btn');
        const skipRoundBtn = document.getElementById('skip-round-btn');
        const toastEl = document.getElementById('toast');
        
        // 输入框
        const principalInput = document.getElementById('principal');
        const minBetInput = document.getElementById('min-bet');
        const maxBetInput = document.getElementById('max-bet');

        // 游戏显示元素
        const balanceDisplay = document.getElementById('current-balance');
        const currentResultDisplay = document.getElementById('current-result');
        const historyContainer = document.getElementById('history-container');
        const chipContainer = document.getElementById('chip-container');
        const betContainer = document.getElementById('bet-container');

        // 统计元素
        const countBEl = document.getElementById('count-B');
        const countPEl = document.getElementById('count-P');
        const countTEl = document.getElementById('count-T');
        const countTotalEl = document.getElementById('count-total');

        // 设置弹窗相关
        const settingsBtn = document.getElementById('settings-btn');
        const limitModal = document.getElementById('limit-modal');
        const limitInputs = document.querySelectorAll('input[name="table-limit"]');

        // 说明弹窗相关
        const infoBtn = document.getElementById('info-btn');
        const infoModal = document.getElementById('info-modal');
        const infoLimitDisplay = document.getElementById('info-limit');

        // 工具函数：显示提示
        function showToast(message, duration = 1500) {
            toastEl.textContent = message;
            toastEl.style.display = 'block';
            
            // 清除之前的定时器（防止重叠）
            if (toastEl.timeoutId) {
                clearTimeout(toastEl.timeoutId);
            }
            
            toastEl.timeoutId = setTimeout(() => {
                toastEl.style.display = 'none';
            }, duration);
        }

        // 验证设置
        function validateSettings() {
            const principal = parseInt(principalInput.value);
            const minBet = parseInt(minBetInput.value);
            const maxBet = parseInt(maxBetInput.value);

            if (isNaN(principal) || principal < 100) {
                showToast('本金必须大于等于 100');
                return false;
            }

            if (isNaN(minBet) || minBet < 1) {
                showToast('最小投注必须大于等于 1');
                return false;
            }

            if (isNaN(maxBet)) {
                showToast('最大投注无效');
                return false;
            }

            if (minBet > maxBet) {
                showToast('最小投注不能大于最大投注');
                return false;
            }

            // 更新状态
            gameState.principal = principal;
            gameState.minBet = minBet;
            gameState.maxBet = maxBet;
            return true;
        }

        // 初始化游戏
        function initGame() {
            if (!validateSettings()) return;

            // 切换页面
            settingsPage.style.display = 'none';
            gamePage.style.display = 'flex';
            
            // 生成本靴最大局数 (58-72之间)
            gameState.maxRounds = Math.floor(Math.random() * (72 - 58 + 1)) + 58;
            console.log(`本靴最大局数: ${gameState.maxRounds}`);

            // 更新 UI
            updateBalance();
            initChips();
            gameState.isGameActive = true;
        }

        // 初始化筹码
        function initChips() {
            const chips = chipContainer.querySelectorAll('.chip');
            let firstValidChip = null;

            chips.forEach(chip => {
                const value = parseInt(chip.dataset.value);
                // 检查是否在范围内
                if (value >= gameState.minBet && value <= gameState.maxBet) {
                    chip.disabled = false;
                    // 默认选中第一个符合条件的筹码
                    if (!firstValidChip) firstValidChip = chip;
                } else {
                    chip.disabled = true;
                }

                chip.onclick = () => selectChip(chip, value);
            });

            // 默认选中逻辑
            if (firstValidChip) {
                selectChip(firstValidChip, parseInt(firstValidChip.dataset.value));
            } else {
                // 如果没有符合条件的固定筹码，可能需要处理（根据需求，题目给定了固定筹码，假设输入会覆盖到至少一个，或者用户需要调整）
                // 严格来说应该允许自定义筹码或更多选项，但根据需求只有4个固定按钮。
                // 如果用户设置 min 2000, max 3000，所有筹码都不可用。
                // 这里做一个防御性处理，如果没有可用筹码，提示用户重置
                if (!firstValidChip) {
                   showToast('当前设置下没有可用的预设筹码，请重新设置');
                   setTimeout(() => {
                       location.reload();
                   }, 2000);
                }
            }
        }

        // 选择筹码
        function selectChip(element, value) {
            if (element.disabled) return;
            
            // 移除其他选中状态
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
            element.classList.add('selected');
            gameState.currentChip = value;
        }

        // 初始化投注选项
        function initBetting() {
            const options = betContainer.querySelectorAll('.bet-option');
            options.forEach(opt => {
                // 移除旧的点击事件监听器 (如果是重新初始化)
                opt.onclick = null; 
                opt.onclick = () => placeBet(opt, opt.dataset.bet);
            });
        }

        // 下注
        function placeBet(element, betType) {
            if (!gameState.currentChip) {
                showToast('请先选择筹码');
                return;
            }

            const chipValue = gameState.currentChip;

            if (gameState.principal < chipValue) {
                showToast('本金不足');
                return;
            }

            // 互斥逻辑：不能同时押庄和闲
            if (betType === 'P' && gameState.bets['B'] > 0) {
                showToast('不能同时押庄和闲');
                return;
            }
            if (betType === 'B' && gameState.bets['P'] > 0) {
                showToast('不能同时押庄和闲');
                return;
            }

            // 更新数据
            gameState.principal -= chipValue;
            gameState.bets[betType] += chipValue;
            
            // 更新 UI
            updateBalance();
            updateBetDisplay();
            
            // 按钮状态
            nextRoundBtn.textContent = '确定下注';
            nextRoundBtn.disabled = false;
            
            // 显示取消按钮，隐藏飞牌按钮
            cancelBetBtn.style.display = 'block';
            skipRoundBtn.style.display = 'none';
        }

        // 取消下注
        function cancelBet() {
            // 退回本金
            const totalBet = gameState.bets.P + gameState.bets.B + gameState.bets.T;
            gameState.principal += totalBet;
            
            // 重置下注
            gameState.bets = { P: 0, B: 0, T: 0 };
            
            // 更新 UI
            updateBalance();
            updateBetDisplay();
            
            // 重置按钮
            nextRoundBtn.textContent = '请下注';
            cancelBetBtn.style.display = 'none';
            skipRoundBtn.style.display = 'block';
        }

        // 更新下注显示
        function updateBetDisplay() {
            const options = betContainer.querySelectorAll('.bet-option');
            options.forEach(opt => {
                const type = opt.dataset.bet;
                const amount = gameState.bets[type];
                const amountEl = opt.querySelector('.bet-amount');
                const spans = opt.querySelectorAll('span'); // 获取所有文字标签
                
                if (amount > 0) {
                    amountEl.textContent = amount;
                    amountEl.style.display = 'block';
                    amountEl.style.fontSize = '24px'; // 放大金额
                    amountEl.style.fontWeight = 'bold';
                    amountEl.style.background = 'transparent'; // 去掉背景
                    amountEl.style.marginTop = '0';
                    
                    // 隐藏原有的文字和赔率
                    spans.forEach(span => span.style.display = 'none');
                    
                    opt.classList.add('selected');
                } else {
                    amountEl.style.display = 'none';
                    
                    // 恢复显示原有的文字和赔率
                    spans.forEach(span => span.style.display = 'inline');
                    
                    opt.classList.remove('selected');
                }
            });
        }

        // 更新本金显示
        function updateBalance() {
            balanceDisplay.textContent = Math.floor(gameState.principal * 100) / 100; // 保留两位小数
        }

        // 生成结果
        function generateResult() {
            const rand = Math.random() * 100;
            if (rand < PROBABILITIES.BANKER) return 'B';
            if (rand < PROBABILITIES.BANKER + PROBABILITIES.PLAYER) return 'P';
            return 'T';
        }

        // 检查是否需要洗牌
        function checkShuffle() {
            // 检查是否是倒数第二局（即下一局是最后一局）
            if (gameState.counts.Total === gameState.maxRounds - 1) {
                // 显示最后一局提示
                setTimeout(() => {
                    showToast('最后一局', 2000);
                }, 500); 
            }

            if (gameState.counts.Total >= gameState.maxRounds) {
                // 使用 setTimeout 延迟洗牌提示，让用户看清最后一局结果
                setTimeout(() => {
                    showToast('本靴牌局结束，正在重新洗牌...', 2000);
                    
                    // 禁用所有操作
                    nextRoundBtn.disabled = true;
                    skipRoundBtn.disabled = true;
                    
                    setTimeout(() => {
                        resetShoe();
                    }, 2000);
                }, 1000);
                
                return true;
            }
            return false;
        }

        // 重置牌靴（洗牌）
        function resetShoe() {
            // 重置统计
            gameState.counts = { P: 0, B: 0, T: 0, Total: 0 };
            updateStats();
            
            // 清空历史记录
            historyContainer.innerHTML = '';
            gameState.history = [];
            
            // 重置结果显示
            currentResultDisplay.innerHTML = '新牌局';
            
            // 重新生成最大局数
            gameState.maxRounds = Math.floor(Math.random() * (72 - 58 + 1)) + 58;
            console.log(`新牌靴最大局数: ${gameState.maxRounds}`);
            
            // 恢复按钮
            nextRoundBtn.textContent = '请下注';
            nextRoundBtn.disabled = false;
            skipRoundBtn.style.display = 'block';
            skipRoundBtn.disabled = false;
            
            showToast('洗牌完成，请开始下注');
        }

        // 飞牌（跳过下注直接开结果）
        function skipRound() {
            // 禁用按钮
            skipRoundBtn.disabled = true;
            nextRoundBtn.disabled = true;
            
            // 生成结果
            const result = generateResult();
            
            // 更新当前局结果
            gameState.currentResult = result;
            const curText = TEXT_MAP[result];
            const curColorClass = `color-${result}`;
            currentResultDisplay.innerHTML = `<span class="${curColorClass}">${curText} (${result})</span>`;
            currentResultDisplay.classList.remove('pop-in');
            void currentResultDisplay.offsetWidth; // 触发重绘
            currentResultDisplay.classList.add('pop-in');

            // 添加历史记录
            addToHistory(result);

            // 检查洗牌
            if (checkShuffle()) return;

            // 恢复按钮
            setTimeout(() => {
                skipRoundBtn.disabled = false;
                nextRoundBtn.disabled = false;
            }, 1500); // 1.5秒冷却时间
        }

        // 确定下注/结算
        function confirmBet() {
            const totalBet = gameState.bets.P + gameState.bets.B + gameState.bets.T;
            if (totalBet === 0) {
                showToast('请下注');
                return;
            }

            // 禁用按钮
            nextRoundBtn.disabled = true;
            nextRoundBtn.textContent = '开奖中...';
            cancelBetBtn.style.display = 'none'; // 开奖时不能取消
            
            // 模拟计算过程
            const result = generateResult();
            
            // 计算派彩
            let payout = 0;
            let winText = '';

            // 规则：
            // 押中赢：本金 + 赔率 * 本金
            // 和局：
            //   - 押和：赢 1:8
            //   - 押庄/闲：退回本金 (Push)
            
            if (result === 'T') {
                // 和局处理
                if (gameState.bets.T > 0) {
                    payout += gameState.bets.T + (gameState.bets.T * PAYOUTS.T);
                    winText += `和赢! `;
                }
                // 退回庄闲本金
                if (gameState.bets.P > 0) {
                    payout += gameState.bets.P;
                    winText += `闲退回 `;
                }
                if (gameState.bets.B > 0) {
                    payout += gameState.bets.B;
                    winText += `庄退回 `;
                }
            } else {
                // 非和局
                if (gameState.bets[result] > 0) {
                    const winAmount = gameState.bets[result] * PAYOUTS[result];
                    payout += gameState.bets[result] + winAmount;
                    winText += `赢 ${winAmount}!`;
                }
            }
            
            // 更新本金
            gameState.principal += payout;
            updateBalance();

            // 更新当前局结果
            gameState.currentResult = result;
            const curText = TEXT_MAP[result];
            const curColorClass = `color-${result}`;
            currentResultDisplay.innerHTML = `<span class="${curColorClass}">${curText} (${result})</span>`;
            currentResultDisplay.classList.remove('pop-in');
            void currentResultDisplay.offsetWidth; // 触发重绘
            currentResultDisplay.classList.add('pop-in');

            // 添加历史记录
            addToHistory(result);

            // 提示输赢
            if (payout > totalBet) {
                showToast(`恭喜！本局盈利 ${payout - totalBet}`);
            } else if (payout === totalBet) {
                 showToast(`本局保本`);
            } else {
                // 输了
            }
            
            // 检查洗牌
            if (checkShuffle()) {
                 // 如果洗牌，重置下注但不恢复按钮（由resetShoe处理）
                 gameState.bets = { P: 0, B: 0, T: 0 };
                 setTimeout(() => {
                      updateBetDisplay();
                 }, 1500);
                 return;
            }

            // 重置下注
            gameState.bets = { P: 0, B: 0, T: 0 };
            setTimeout(() => {
                 updateBetDisplay();
                 nextRoundBtn.textContent = '请下注';
                 nextRoundBtn.disabled = false;
                 
                 // 恢复飞牌按钮
                 skipRoundBtn.style.display = 'block';
            }, 1500);
        }

        // 添加历史记录
        function addToHistory(result) {
            const item = document.createElement('div');
            item.className = `history-item bg-${result} pop-in`;
            item.textContent = result;
            
            // 插入到最前面
            if (historyContainer.firstChild) {
                historyContainer.insertBefore(item, historyContainer.firstChild);
            } else {
                historyContainer.appendChild(item);
            }
            
            // 更新统计
            gameState.counts[result]++;
            gameState.counts.Total++;
            updateStats();
            
            // 滚动到最左侧 (新结果在最左)
            historyContainer.scrollLeft = 0;
        }

        // 更新统计显示
        function updateStats() {
            countBEl.textContent = gameState.counts.B;
            countPEl.textContent = gameState.counts.P;
            countTEl.textContent = gameState.counts.T;
            countTotalEl.textContent = gameState.counts.Total;
        }

        // 事件绑定
        startGameBtn.addEventListener('click', initGame);
        nextRoundBtn.addEventListener('click', confirmBet);
        cancelBetBtn.addEventListener('click', cancelBet);
        skipRoundBtn.addEventListener('click', skipRound);
        
        // 设置弹窗事件
        function toggleModal(show) {
            if (show) {
                limitModal.classList.add('active');
                // 选中当前限红
                const currentVal = `${gameState.minBet}-${gameState.maxBet}`;
                limitInputs.forEach(input => {
                    if (input.value === currentVal) input.checked = true;
                });
            } else {
                limitModal.classList.remove('active');
            }
        }

        settingsBtn.addEventListener('click', () => toggleModal(true));
        
        limitModal.addEventListener('click', (e) => {
            if (e.target === limitModal) toggleModal(false);
        });

        limitInputs.forEach(input => {
            input.addEventListener('change', (e) => {
                const [min, max] = e.target.value.split('-').map(Number);
                
                gameState.minBet = min;
                gameState.maxBet = max;
                
                initChips(); // 重新检查筹码可用性
                
                // 提示用户并关闭弹窗
                showToast(`限红已切换: ${min} - ${max}`);
                
                // 自动更新输入框
                minBetInput.value = min;
                maxBetInput.value = max;

                // 更新说明弹窗中的限红
                infoLimitDisplay.textContent = `${min} - ${max.toLocaleString()}`;
                
                setTimeout(() => toggleModal(false), 300);
            });
        });

        // 说明弹窗事件
        function toggleInfoModal(show) {
            if (show) {
                infoModal.classList.add('active');
                // 更新当前限红显示
                infoLimitDisplay.textContent = `${gameState.minBet} - ${gameState.maxBet.toLocaleString()}`;
            } else {
                infoModal.classList.remove('active');
            }
        }

        infoBtn.addEventListener('click', () => toggleInfoModal(true));
        infoModal.addEventListener('click', (e) => {
            if (e.target === infoModal) toggleInfoModal(false);
        });

        // 初始化投注点击
        initBetting();

    </script>
</body>
</html>